<div style="display: flex; flex-direction: column; gap: 20px; max-width: 100%;">
  <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
    <div>
      <h2 style="margin: 0;">ğŸ“‹ Jobs Queue</h2>
      <p>Monitor and manage background jobs</p>
    </div>

    <div style="display: flex; gap: 20px; align-items: center;">
      <span>ğŸŸ¡ Pending: <%= stats.pending %></span>
      <span>ğŸ”„ Processing: <%= stats.processing %></span>
      <span>ğŸŸ¢ Completed: <%= stats.completed %></span>
      <span>ğŸ”´ Failed: <%= stats.failed %></span>
    </div>
  </div>

  <div style="display: flex; gap: 10px; align-items: center;">
    <a href="/admin/jobs" style="<%= !filter ? 'font-weight: bold;' : '' %>">All</a>
    <a href="/admin/jobs?filter=pending" style="<%= filter === 'pending' ? 'font-weight: bold;' : '' %>">Pending</a>
    <a href="/admin/jobs?filter=processing" style="<%= filter === 'processing' ? 'font-weight: bold;' : '' %>">Processing</a>
    <a href="/admin/jobs?filter=completed" style="<%= filter === 'completed' ? 'font-weight: bold;' : '' %>">Completed</a>
    <a href="/admin/jobs?filter=failed" style="<%= filter === 'failed' ? 'font-weight: bold;' : '' %>">Failed</a>
  </div>

  <div style="display: flex; flex-direction: column; gap: 20px; max-width: 100%;">
    <div style="border-style: dashed; border-radius: 5px; padding: 20px; width: 100%; display: flex; flex-direction: column; gap: 10px;">
      <div style="display: flex; flex-direction: column; gap: 5px; overflow-x: auto;">

        <% if (jobs.length) { %>
          <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
            <thead>
              <tr style="border-bottom: 1px dashed #ddd;">
                <th style="text-align: left; padding: 8px;">ğŸ·ï¸ ID</th>
                <th style="text-align: left; padding: 8px;">ğŸ“¡ Type</th>
                <th style="text-align: left; padding: 8px;">ğŸš¦ Status</th>
                <th style="text-align: left; padding: 8px;">ğŸ”„ Attempts</th>
                <th style="text-align: left; padding: 8px;">â° Run At</th>
                <th style="text-align: left; padding: 8px;">ğŸ—“ï¸ Created</th>
                <th style="text-align: left; padding: 8px;">âš¡ï¸ Actions</th>
              </tr>
            </thead>

            <tbody>
              <% jobs.forEach(job => { %>
                <tr style="border-bottom: 1px dashed #ddd;">
                  <td style="padding: 8px;"><%= job.id %></td>

                  <td style="padding: 8px;">
                    <% if (job.type === 'discord') { %>
                      ğŸ’¬ Discord
                    <% } else if (job.type === 'email') { %>
                      âœ‰ï¸ Email
                    <% } else if (job.type === 'sms') { %>
                      ğŸ“± SMS
                    <% } else { %>
                      <%= job.type %>
                    <% } %>
                  </td>

                  <td style="padding: 8px;">
                    <span style="padding: 2px 8px; border-radius: 5px;
                      <% if (job.status === 'pending') { %>
                        color: orange; border: 1px solid orange;
                      <% } else if (job.status === 'processing') { %>
                        color: blue; border: 1px solid blue;
                      <% } else if (job.status === 'completed') { %>
                        color: green; border: 1px solid green;
                      <% } else if (job.status === 'failed') { %>
                        color: red; border: 1px solid red;
                      <% } %>
                    ">
                      <%= job.status %>
                    </span>
                  </td>

                  <td style="padding: 8px;"><%= job.attempts %> / <%= job.max_attempts %></td>

                  <td style="padding: 8px;"><%= job.run_at %></td>

                  <td style="padding: 8px;"><%= job.created_at %></td>

                  <td style="padding: 8px; display: flex; gap: 10px;">
                    <button class="no-style-btn" onclick="this.nextElementSibling.showModal()">ğŸ” Details</button>
                    <dialog style="width: 600px;">
                      <h3>Job #<%= job.id %> Details</h3>

                      <div style="display: flex; flex-direction: column; gap: 10px;">
                        <div>
                          <strong>Payload:</strong>
                          <pre style="margin-top: 5px; padding: 10px; border: 1px dashed; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; word-break: break-word;"><%= JSON.stringify(JSON.parse(job.payload), null, 2) %></pre>
                        </div>

                        <% if (job.error) { %>
                          <div>
                            <strong>Error:</strong>
                            <pre style="margin-top: 5px; padding: 10px; border: 1px dashed red; border-radius: 5px; color: red; overflow-x: auto; white-space: pre-wrap; word-break: break-word;"><%= job.error %></pre>
                          </div>
                        <% } %>
                      </div>

                      <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" onclick="this.closest('dialog').close()">Close</button>
                      </div>
                    </dialog>

                    <% if (job.status === 'failed') { %>
                      <form method="POST" action="/admin/jobs/<%= job.id %>/retry" style="display: inline;">
                        <input type="hidden" name="csrfToken" value="<%= csrfToken %>" />
                        <button class="no-style-btn" type="submit">ğŸ”„ Retry</button>
                      </form>
                    <% } %>

                    <form method="POST" action="/admin/jobs/<%= job.id %>/delete" style="display: inline;">
                      <input type="hidden" name="csrfToken" value="<%= csrfToken %>" />
                      <button class="no-style-btn" type="submit">ğŸ—‘ï¸ Delete</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p>ğŸ“­ No jobs found</p>
        <% } %>

      </div>
    </div>
  </div>
</div>
